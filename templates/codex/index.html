{% extends "base.html" %}
{% load static %}
{% block title %}Códex{% endblock %}

{% block content %}
<style>
  /* ==== Estilos locales, acotados al #codex ==== */
  #codex .lead{color:var(--text-dim,rgba(255,255,255,.72))}
  #codex .media-16x9{aspect-ratio:16/9;overflow:hidden;border-radius:12px;border:1px solid var(--line)}
  #codex .media-16x9 > img{width:100%;height:100%;object-fit:cover;display:block}

  /* Historias (grandes) */
  #codex .grid-stories{display:grid;gap:1rem;grid-template-columns:1fr}
  @media (min-width:900px){#codex .grid-stories{grid-template-columns:repeat(3,minmax(0,1fr))}}

  /* Guías (grid amplio) */
  #codex .grid-guides{display:grid;gap:1rem;grid-template-columns:1fr}
  @media (min-width:880px){#codex .grid-guides{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media (min-width:1220px){#codex .grid-guides{grid-template-columns:repeat(3,minmax(0,1fr))}}

  /* Tiles grandes para sprites */
  #codex .grid-tiles{display:grid;gap:1rem;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
  #codex .tile{display:flex;flex-direction:column;align-items:center;gap:.6rem;padding:clamp(12px,1.6vw,16px)}
  #codex .tile img{width:100%;height:clamp(200px,28vh,260px);object-fit:contain} /* <-- tamaño grande */
  #codex .tile-name{text-align:center;font-size:clamp(1rem,1.3vw,1.15rem)}

  /* Chips más grandes */
  #codex .chip-lg{display:inline-flex;align-items:center;gap:.5rem;padding:.55rem .85rem;border-radius:9999px;border:1px solid var(--line);background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(0,0,0,.08))}

  /* Separador sutil */
  #codex .hr{height:1px;background:linear-gradient(90deg,transparent,var(--line),transparent);margin:1rem 0}
</style>

<section id="codex" class="section">
  <div class="grid lg:grid-cols-3 gap-6">
    <!-- ===== Columna principal (ancha) ===== -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Encabezado -->
      <div class="card">
        <h1 class="h1-glow text-4xl">Códex del Nexo</h1>
        <p class="lead mt-2">
          Historias, personajes, enemigos, dominios, artefactos y guías estratégicas. Todo el lore y contenido jugable en un solo lugar.
        </p>
      </div>

      <!-- Historias + Emblemas -->
      <div class="card">
        <h3 class="card-title"><i class="fa-solid fa-book"></i> Últimas historias</h3>
        <div class="grid-stories">
          {% for x in latest_lore %}
            <a href="{{ x.get_absolute_url }}" class="card hover:translate-y-[-2px] transition">
              {% if x.cover_image %}
                <figure class="media-16x9">
                  <img src="{{ x.cover_image.url }}" alt="Portada de {{ x.title }}" loading="lazy" decoding="async">
                </figure>
              {% endif %}
              <h4 class="mt-2">{{ x.title }}</h4>
              <p class="text-white/60 text-sm">{{ x.summary|truncatechars:200 }}</p>
            </a>
          {% empty %}
            <p class="text-white/60">Sin historias aún.</p>
          {% endfor %}
        </div>

        <div class="hr"></div>

        <h3 class="card-title"><i class="fa-solid fa-fire-flame-curved"></i> Emblemas recientes</h3>
        <div class="flex flex-wrap gap-2">
          {% for a in latest_artifacts %}
            <a href="{{ a.get_absolute_url }}" class="chip-lg hover:opacity-90">
              <i class="fa-regular fa-gem"></i> {{ a.name }}
            </a>
          {% empty %}
            <p class="text-white/60">Aún no hay Emblemas.</p>
          {% endfor %}
        </div>
      </div>

      <!-- Personajes y Enemigos (más grandes) -->
      <div class="grid lg:grid-cols-2 gap-6">
        <div class="card">
          <h3 class="card-title"><i class="fa-solid fa-users"></i> Personajes</h3>
          <div class="grid-tiles">
            {% for c in latest_characters %}
              <a class="card tile" href="{{ c.get_absolute_url }}">
                {% if c.sprite_gif %}
                  <img src="{{ c.sprite_gif.url }}" alt="Sprite de {{ c.name }}" loading="lazy" decoding="async">
                {% elif c.sprite_still %}
                  <img src="{{ c.sprite_still.url }}" alt="Sprite de {{ c.name }}" loading="lazy" decoding="async">
                {% endif %}
                <div class="tile-name">{{ c.name }}</div>
              </a>
            {% empty %}
              <p class="text-white/60">Sin personajes todavía.</p>
            {% endfor %}
          </div>
        </div>

        <div class="card">
          <h3 class="card-title"><i class="fa-solid fa-ghost"></i> Enemigos</h3>
          <div class="grid-tiles">
            {% for e in latest_enemies %}
              <a class="card tile" href="{{ e.get_absolute_url }}">
                {% if e.sprite_gif %}
                  <img src="{{ e.sprite_gif.url }}" alt="Sprite de {{ e.name }}" loading="lazy" decoding="async">
                {% elif e.sprite_still %}
                  <img src="{{ e.sprite_still.url }}" alt="Sprite de {{ e.name }}" loading="lazy" decoding="async">
                {% endif %}
                <div class="tile-name">{{ e.name }}</div>
              </a>
            {% empty %}
              <p class="text-white/60">Sin enemigos todavía.</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Guías (tarjetas grandes) -->
      <div class="card">
        <h3 class="card-title"><i class="fa-solid fa-lightbulb"></i> Guías</h3>
        <div class="grid-guides">
          {% for g in latest_guides %}
            <a href="{{ g.get_absolute_url }}" class="card">
              {% if g.cover_image %}
                <figure class="media-16x9">
                  <img src="{{ g.cover_image.url }}" alt="Cover de {{ g.title }}" loading="lazy" decoding="async">
                </figure>
              {% endif %}
              <h4 class="mt-2">{{ g.title }}</h4>
              <p class="text-white/60 text-sm">{{ g.summary|truncatechars:200 }}</p>
              <div class="mt-1 text-white/50 text-sm">Lectura: ~{{ g.read_time }} min</div>
            </a>
          {% empty %}
            <p class="text-white/60">Sin guías por ahora.</p>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ===== Sidebar (sticky en desktop) ===== -->
    <aside class="card lg:sticky top-4 h-fit">
      <h3 class="card-title"><i class="fa-solid fa-compass"></i> Categorías</h3>
      <ul class="space-y-2">
        <li><a class="link-soft" href="{% url 'codex:lore_index' %}"><i class="fa-solid fa-book-open mr-2"></i>Historias</a></li>
        <li><a class="link-soft" href="{% url 'codex:characters_index' %}"><i class="fa-solid fa-user-ninja mr-2"></i>Personajes</a></li>
        <li><a class="link-soft" href="{% url 'codex:enemies_index' %}"><i class="fa-solid fa-skull mr-2"></i>Enemigos</a></li>
        <li><a class="link-soft" href="{% url 'codex:domains_index' %}"><i class="fa-solid fa-mountain mr-2"></i>Dominios</a></li>
        <li><a class="link-soft" href="{% url 'codex:artifacts_index' %}"><i class="fa-solid fa-gem mr-2"></i>Emblemas</a></li>
        <li><a class="link-soft" href="{% url 'codex:guides_index' %}"><i class="fa-solid fa-lightbulb mr-2"></i>Guías</a></li>
      </ul>

      <div class="hr"></div>
      <h3 class="card-title"><i class="fa-solid fa-landmark"></i> Dominios</h3>
      <div class="grid grid-cols-2 gap-2">
        {% for d in domains %}
          <a class="btn-ghost" href="{{ d.get_absolute_url }}">
            {% if d.icon %}<i class="{{ d.icon }} mr-2"></i>{% endif %}{{ d.name }}
          </a>
        {% empty %}
          <p class="text-white/60">Sin dominios aún.</p>
        {% endfor %}
      </div>
    </aside>
  </div>
</section>
{% endblock %}
