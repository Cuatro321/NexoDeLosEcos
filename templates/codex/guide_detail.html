{% extends "base.html" %}
{% load static %}
{% block title %}{{ item.title }} · Guía{% endblock %}

{% block content %}
<section class="section">
  <!-- BREADCRUMB -->
  <nav class="text-white/60 text-sm mb-2">
    <a href="{% url 'codex:index' %}" class="link-soft">Códex</a>
    <span class="mx-1">/</span>
    <a href="{% url 'codex:guides_index' %}" class="link-soft">Guías</a>
    <span class="mx-1">/</span>
    <span class="text-white">{{ item.title }}</span>
  </nav>

  <article class="card">
    <header>
      <h1 class="h1-glow text-3xl">{{ item.title }}</h1>

      <div class="flex flex-wrap items-center gap-2 text-sm mt-2">
        {% if item.domain %}
          <span class="chip">
            <i class="fa-solid fa-scroll mr-1"></i>
            <a class="link-soft" href="{{ item.domain.get_absolute_url }}">{{ item.domain.name }}</a>
          </span>
        {% endif %}
        {% if item.read_time %}<span class="tag">{{ item.read_time }} min</span>{% endif %}
        {% if item.updated %}
          <span class="text-white/50">Actualizada {{ item.updated|date:"d M Y" }}</span>
        {% endif %}
      </div>

      {% if item.cover_image %}
        <div class="mt-3" style="aspect-ratio:16/9;overflow:hidden;border:1px solid var(--line);border-radius:.5rem">
          <img src="{{ item.cover_image.url }}" alt="" style="width:100%;height:100%;object-fit:cover">
        </div>
      {% endif %}

      {% if item.summary %}
        <p class="text-white/70 mt-3">{{ item.summary }}</p>
      {% endif %}
    </header>

    <div class="hr-soft"></div>

    <!-- CUERPO -->
    <div class="prose prose-invert max-w-none">
      {{ item.body|linebreaks }}
    </div>

    <div class="hr-soft"></div>

    <!-- TAGS -->
    {% if item.tags %}
      <p class="text-white/50 text-sm">Tags: {{ item.tags }}</p>
    {% endif %}

    <!-- RELACIONADOS -->
    {% with arts=item.related_artifacts.all chars=item.related_characters.all enems=item.related_enemies.all %}
      {% if arts or chars or enems %}
        <div class="hr-soft"></div>
        <div class="grid md:grid-cols-3 gap-3">
          {% if arts %}
            <section>
              <h3 class="card-title"><i class="fa-solid fa-gem"></i> Emblemas</h3>
              <ul class="list-disc ml-5">
                {% for a in arts %}
                  <li><a class="link-soft" href="{{ a.get_absolute_url }}">{{ a.name }}</a></li>
                {% endfor %}
              </ul>
            </section>
          {% endif %}

          {% if chars %}
            <section>
              <h3 class="card-title"><i class="fa-solid fa-user-ninja"></i> Personajes</h3>
              <ul class="list-disc ml-5">
                {% for c in chars %}
                  <li><a class="link-soft" href="{{ c.get_absolute_url }}">{{ c.name }}</a></li>
                {% endfor %}
              </ul>
            </section>
          {% endif %}

          {% if enems %}
            <section>
              <h3 class="card-title"><i class="fa-solid fa-skull"></i> Enemigos</h3>
              <ul class="list-disc ml-5">
                {% for e in enems %}
                  <li><a class="link-soft" href="{{ e.get_absolute_url }}">{{ e.name }}</a></li>
                {% endfor %}
              </ul>
            </section>
          {% endif %}
        </div>
      {% endif %}
    {% endwith %}
  </article>
</section>
{% endblock %}
