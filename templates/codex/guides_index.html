{% extends "base.html" %}
{% load static %}
{% block title %}Códex · Guías{% endblock %}

{% block content %}
<section class="section">
  <div class="flex items-center justify-between">
    <h1 class="h1-glow text-2xl md:text-3xl">
      <i class="fa-solid fa-compass mr-2"></i>Guías y Estrategias
    </h1>
    <a href="{% url 'codex:index' %}" class="link-soft">
      <i class="fa-solid fa-arrow-left mr-2"></i>Volver al Códex
    </a>
  </div>
  <p class="text-white/70 mt-2">
    Rutas, recomendaciones de emblemas y consejos por entorno, personaje y enemigo.
  </p>
</section>

<section class="grid md:grid-cols-2 lg:grid-cols-3 gap-5">
  {% for g in page_obj %}
    <article class="card hover:translate-y-[-2px] transition">
      {% if g.cover_image %}
        <div style="aspect-ratio:16/9;overflow:hidden;border-radius:.5rem;border:1px solid var(--line)">
          <img src="{{ g.cover_image.url }}" alt="{{ g.title }}" style="width:100%;height:100%;object-fit:cover">
        </div>
      {% else %}
        <div style="aspect-ratio:16/9;display:grid;place-items:center;border-radius:.5rem;border:1px solid var(--line);background:rgba(255,255,255,.05)">
          <img src="{% static 'img/placeholders/cover.png' %}" alt="" style="height:56px;opacity:.7">
        </div>
      {% endif %}

      <header class="mt-3">
        <div class="flex items-center justify-between gap-2">
          <h3 class="card-title">{{ g.title }}</h3>
          <div class="flex items-center gap-2">
            {% if g.domain %}<span class="chip"><i class="fa-solid fa-scroll mr-1"></i>{{ g.domain.name }}</span>{% endif %}
            {% if g.read_time %}<span class="tag">{{ g.read_time }} min</span>{% endif %}
          </div>
        </div>
        {% if g.summary %}
          <p class="text-white/60 text-sm mt-1">{{ g.summary|truncatechars:140 }}</p>
        {% endif %}
      </header>

      <footer class="mt-3 flex items-center justify-between">
        <a class="link-soft" href="{% url 'codex:guide_detail' g.slug %}">
          Leer guía <i class="fa-solid fa-arrow-right ml-1"></i>
        </a>
        {% if g.updated %}
          <span class="text-white/50 text-xs">Actualizada {{ g.updated|date:"d M Y" }}</span>
        {% endif %}
      </footer>
    </article>
  {% empty %}
    <p class="text-white/70">Aún no hay guías cargadas.</p>
  {% endfor %}
</section>

{% if page_obj.has_other_pages %}
<nav class="mt-6 flex items-center gap-2">
  {% if page_obj.has_previous %}
    <a class="btn-ghost" href="?page={{ page_obj.previous_page_number }}">‹ Anterior</a>
  {% endif %}
  <span class="text-white/60">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
  {% if page_obj.has_next %}
    <a class="btn-ghost" href="?page={{ page_obj.next_page_number }}">Siguiente ›</a>
  {% endif %}
</nav>
{% endif %}
{% endblock %}
