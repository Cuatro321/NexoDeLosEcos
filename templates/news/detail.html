{% extends "base.html" %}
{% load static news_extras humanize %}
{% block title %}{{ item.title }} · Noticias{% endblock %}

{% block content %}
<style>
  /* ===== News detail (local) ===== */
  #news-detail .breadcrumb{
    font-size:.8rem;
    color:rgba(148,163,184,.9);
  }

  #news-detail .news-article{
    border-radius:20px;
    padding:1.4rem 1.6rem 1.6rem;
    border:1px solid rgba(148,163,184,.55);
    background:rgba(15,23,42,.98);
    box-shadow:0 24px 60px rgba(15,23,42,.95);
  }

  #news-detail .news-hero{
    border-radius:16px;
    padding:1.1rem 1.2rem 1.25rem;
    margin:-.2rem -0.2rem 1.1rem;
    background:
      radial-gradient(circle at top left,rgba(56,189,248,.40),transparent 55%),
      radial-gradient(circle at bottom right,rgba(250,204,21,.28),transparent 60%),
      #020617;
    border:1px solid rgba(148,163,184,.6);
    display:grid;
    grid-template-columns:minmax(0,1.6fr) minmax(0,1.2fr);
    gap:1.2rem;
  }

  #news-detail .news-kicker{
    font-size:.78rem;
    letter-spacing:.25em;
    text-transform:uppercase;
    color:rgba(148,163,184,.9);
    margin-bottom:.3rem;
  }

  #news-detail .news-hero h1{
    margin:0 0 .4rem;
  }

  #news-detail .news-hero-summary{
    color:rgba(226,232,240,.9);
    font-size:.92rem;
    margin-top:.4rem;
  }

  #news-detail .news-meta{
    margin-top:.6rem;
    display:flex;
    flex-wrap:wrap;
    gap:.4rem;
    font-size:.78rem;
  }

  #news-detail .news-pill{
    padding:.22rem .75rem;
    border-radius:999px;
    border:1px solid rgba(148,163,184,.9);
    background:rgba(15,23,42,.95);
    display:inline-flex;
    align-items:center;
    gap:.35rem;
  }

  #news-detail .news-pill.patch{
    border-color:rgba(251,191,36,.95);
    color:#facc15;
  }

  #news-detail .news-cover{
    border-radius:14px;
    overflow:hidden;
    border:1px solid rgba(148,163,184,.75);
    aspect-ratio:16/9;
    background:radial-gradient(circle at 20% 0,rgba(255,255,255,.18),transparent 60%);
  }
  #news-detail .news-cover img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }

  #news-detail .news-video-wrap{
    margin-top:1.2rem;
  }

  #news-detail .news-body{
    margin-top:1.1rem;
  }

  #news-detail .news-body .prose{
    font-size:.95rem;
  }

  #news-detail .news-gallery{
    margin-top:1.4rem;
  }
  #news-detail .news-gallery-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:1rem;
  }

  #news-detail .news-gallery-item{
    border-radius:14px;
    overflow:hidden;
    border:1px solid rgba(148,163,184,.45);
    background:rgba(15,23,42,.95);
  }
  #news-detail .news-gallery-item img,
  #news-detail .news-gallery-item video{
    width:100%;
    height:auto;
    display:block;
  }
  #news-detail .news-gallery-item figcaption{
    padding:.45rem .7rem .55rem;
    font-size:.8rem;
    color:rgba(209,213,219,.86);
  }

  #news-detail .news-related{
    margin-top:1.6rem;
  }
  #news-detail .news-related-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
    gap:1rem;
  }
  #news-detail .news-related-card{
    border-radius:14px;
    padding:.8rem;
    background:rgba(15,23,42,.98);
    border:1px solid rgba(55,65,81,.95);
    box-shadow:0 18px 38px rgba(0,0,0,.8);
    transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  #news-detail .news-related-card:hover{
    transform:translateY(-3px);
    border-color:rgba(96,165,250,.9);
    box-shadow:0 22px 48px rgba(0,0,0,.9);
  }
  #news-detail .news-related-thumb{
    aspect-ratio:16/9;
    border-radius:10px;
    overflow:hidden;
    border:1px solid rgba(148,163,184,.35);
    margin-bottom:.5rem;
  }
  #news-detail .news-related-thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
  }
  #news-detail .news-related-title{
    font-size:.95rem;
    font-weight:600;
  }
  #news-detail .news-related-summary{
    margin-top:.25rem;
    font-size:.8rem;
    color:rgba(209,213,219,.85);
  }

  @media (max-width:1024px){
    #news-detail .news-hero{
      grid-template-columns:1fr;
    }
  }
</style>

<section id="news-detail" class="section">

  <!-- Breadcrumb + volver -->
  <div class="flex items-center justify-between mb-3 gap-3">
    <nav class="breadcrumb">
      <a href="{% url 'news:index' %}" class="link-soft">Noticias</a>
      <span class="mx-1">/</span>
      <span class="text-white">{{ item.title }}</span>
    </nav>

    <a href="{% url 'news:index' %}" class="btn-ghost">
      <i class="fa-solid fa-arrow-left mr-1"></i> Volver al feed
    </a>
  </div>

  <article class="news-article card">
    <!-- HERO -->
    <header class="news-hero">
      <div>
        <p class="news-kicker">
          {% if item.category %}
            {% if item.category.icon %}<i class="{{ item.category.icon }} mr-1"></i>{% endif %}
            {{ item.category.name }}
          {% else %}
            Noticias
          {% endif %}
        </p>

        <h1 class="h1-glow text-3xl md:text-4xl">{{ item.title }}</h1>

        {% if item.summary %}
          <p class="news-hero-summary">
            {{ item.summary }}
          </p>
        {% endif %}

        <div class="news-meta">
          {% if item.version %}
            <span class="news-pill patch">
              <i class="fa-solid fa-code-branch"></i> v{{ item.version }}
            </span>
          {% endif %}
          {% if item.is_patch_notes %}
            <span class="news-pill patch">
              <i class="fa-solid fa-screwdriver-wrench"></i> Notas del parche
            </span>
          {% endif %}
          <span class="news-pill">
            <i class="fa-regular fa-clock"></i>
            {{ item.publish_at|naturaltime }} · {{ item.reading_time }} min
          </span>
        </div>
      </div>

      {% if item.banner_image or item.hero_image %}
        <figure class="news-cover">
          {% if item.banner_image %}
            <img src="{{ item.banner_image.url }}" alt="">
          {% elif item.hero_image %}
            <img src="{{ item.hero_image.url }}" alt="">
          {% endif %}
        </figure>
      {% endif %}
    </header>

    <!-- VIDEO -->
    {% if item.video_url %}
      <div class="news-video-wrap">
        {% with embed=item.video_url|youtube_embed %}
          {% if embed %}
            <div class="aspect-video rounded-md overflow-hidden border border-white/10">
              <iframe
                src="{{ embed }}"
                style="width:100%;height:100%"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen>
              </iframe>
            </div>
          {% elif item.video_url|is_http_video %}
            <video class="mt-4 w-full rounded-md border border-white/10" controls>
              <source src="{{ item.video_url }}">
              Tu navegador no soporta el tag <code>video</code>.
            </video>
          {% else %}
            <p class="text-white/60 mt-3">
              Este video no permite incrustación aquí.
              <a class="link-soft" href="{{ item.video_url }}" target="_blank" rel="noopener">Ver en YouTube</a>.
            </p>
          {% endif %}
        {% endwith %}
      </div>
    {% endif %}

    <!-- CUERPO -->
    <section class="news-body">
      <div class="prose prose-invert mt-2 max-w-none">
        {{ item.body|safe }}
      </div>
    </section>

    <!-- GALERÍA -->
    {% if item.gallery.all %}
      <section class="news-gallery">
        <h3 class="card-title">
          <i class="fa-regular fa-images mr-2"></i> Galería
        </h3>
        <div class="news-gallery-grid mt-2">
          {% for asset in item.gallery.all %}
            <figure class="news-gallery-item">
              {% if asset.kind == 'video' %}
                <video controls class="w-full">
                  <source src="{{ asset.file.url }}">
                </video>
              {% else %}
                <img src="{{ asset.file.url }}" alt="{{ asset.caption }}">
              {% endif %}
              {% if asset.caption %}
                <figcaption>{{ asset.caption }}</figcaption>
              {% endif %}
            </figure>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    <!-- RELACIONADAS -->
    {% if related %}
      <section class="news-related">
        <h3 class="card-title">
          <i class="fa-solid fa-newspaper mr-2"></i> Más novedades del Nexo
        </h3>
        <div class="news-related-grid mt-2">
          {% for n in related %}
            <a href="{{ n.get_absolute_url }}" class="news-related-card">
              <div class="news-related-thumb">
                {% if n.hero_image %}
                  <img src="{{ n.hero_image.url }}" alt="">
                {% elif n.banner_image %}
                  <img src="{{ n.banner_image.url }}" alt="">
                {% else %}
                  <div class="w-full h-full flex items-center justify-center text-white/30">
                    Sin imagen
                  </div>
                {% endif %}
              </div>
              <div class="news-related-title">{{ n.title }}</div>
              {% if n.summary %}
                <p class="news-related-summary">
                  {{ n.summary|truncatechars:120 }}
                </p>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </article>
</section>
{% endblock %}
