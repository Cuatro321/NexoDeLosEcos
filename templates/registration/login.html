{% extends 'base.html' %}
{% load static %}
{% block title %}Entrar · El Nexo de los Ecos{% endblock %}

{% block head %}
<style>
  /* Estructura base con video de fondo */
  .login-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  .login-video-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -2;
  }

  .login-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: radial-gradient(circle at top, rgba(15,23,42,0.4), transparent 45%),
                linear-gradient(
                  135deg,
                  rgba(0, 0, 0, 0.9) 0%,
                  rgba(0, 0, 0, 0.7) 50%,
                  rgba(0, 0, 0, 0.9) 100%
                );
    z-index: -1;
  }

  /* Partículas decorativas */
  .login-particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
  }

  .login-particle {
    position: absolute;
    background: rgba(var(--accent-rgb), 0.3);
    border-radius: 50%;
    animation: floatLogin 8s infinite ease-in-out;
  }

  @keyframes floatLogin {
    0%, 100% {
      transform: translateY(0px) rotate(0deg) scale(1);
      opacity: 0.25;
    }
    50% { 
      transform: translateY(-30px) rotate(180deg) scale(1.2);
      opacity: 0.6;
    }
  }

  /* Tarjeta principal con imagen de fondo DENTRO del formulario */
  .login-card {
    background:
      linear-gradient(
        135deg,
        rgba(15, 23, 42, 0.96) 0%,
        rgba(15, 23, 42, 0.85) 40%,
        rgba(15, 23, 42, 0.9) 100%
      ),
      url('{% static "img/fotologin.png" %}') center/cover;
    background-blend-mode: overlay;
    
    backdrop-filter: blur(22px);
    border: 1px solid rgba(148, 163, 184, 0.45);
    border-radius: 26px;
    padding: 3rem;
    box-shadow: 
      0 26px 60px rgba(0, 0, 0, 0.7),
      0 0 120px rgba(var(--accent-rgb), 0.18),
      inset 0 1px 0 rgba(255, 255, 255, 0.04);
    animation: cardEntrance 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
    max-width: 420px;
    width: 100%;
    min-height: 500px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  /* Borde glow sutil */
  .login-card::before {
    content: '';
    position: absolute;
    inset: 1px;
    border-radius: 25px;
    background: linear-gradient(
      135deg,
      rgba(56, 189, 248, 0.12),
      rgba(249, 115, 22, 0.12),
      rgba(129, 140, 248, 0.12)
    );
    opacity: 0.6;
    z-index: -1;
  }

  /* Brillo en movimiento sobre la card */
  .login-card::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
      45deg,
      transparent 0%,
      rgba(255, 255, 255, 0.06) 50%,
      transparent 100%
    );
    animation: bgShine 6s ease-in-out infinite;
    z-index: 1;
    pointer-events: none;
    opacity: 0.0;
  }

  @keyframes bgShine {
    0%, 100% {
      opacity: 0;
      transform: translateX(-100%);
    }
    50% {
      opacity: 1;
      transform: translateX(100%);
    }
  }

  @keyframes cardEntrance {
    0% {
      opacity: 0;
      transform: translateY(50px) scale(0.9);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .login-content {
    position: relative;
    z-index: 2;
  }

  /* Header mejorado */
  .login-header {
    text-align: center;
    margin-bottom: 2.5rem;
    position: relative;
  }

  .login-icon {
    width: 96px;
    height: 96px;
    margin: 0 auto 1.75rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    border: 1px solid rgba(248, 250, 252, 0.4);
    backdrop-filter: blur(14px);
    background: radial-gradient(circle at 30% 20%, rgba(248, 250, 252, 0.25), rgba(15, 23, 42, 0.95));
    box-shadow:
      0 0 40px rgba(249, 115, 22, 0.35),
      inset 0 0 12px rgba(0, 0, 0, 0.7);
    overflow: hidden;
  }

  .login-icon::before {
    content: '';
    position: absolute;
    inset: -14px;
    background: radial-gradient(circle, rgba(249, 115, 22, 0.5), transparent 60%);
    opacity: 0.6;
    filter: blur(20px);
    z-index: -1;
  }

  .login-custom-icon {
    width: 68px;
    height: 68px;
    object-fit: contain;
    filter: none; /* colores reales del logo */
  }

  .login-header h1 {
    letter-spacing: -0.03em;
  }

  /* Formulario */
  .form-group {
    margin-bottom: 1.5rem;
    position: relative;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: rgba(248, 250, 252, 0.95);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
    font-size: 0.9rem;
  }

  .input-wrapper {
    position: relative;
    border-radius: 12px;
    transition: all 0.3s ease;
    background: rgba(15, 23, 42, 0.75);
    border: 1px solid rgba(148, 163, 184, 0.55);
    backdrop-filter: blur(15px);
  }

  .input-wrapper:focus-within {
    border-color: rgba(249, 115, 22, 0.85);
    box-shadow: 
      0 0 0 1px rgba(249, 115, 22, 0.8),
      0 12px 30px rgba(15, 23, 42, 0.9);
    transform: translateY(-1px);
    background: rgba(15, 23, 42, 0.9);
  }

  .input-wrapper input {
    width: 100%;
    padding: 1rem 1rem 1rem 3rem;
    background: transparent;
    border: none;
    color: #f9fafb;
    font-size: 0.98rem;
    transition: all 0.3s ease;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .input-wrapper input:focus {
    outline: none;
  }

  .input-wrapper input::placeholder {
    color: rgba(148, 163, 184, 0.85);
    text-shadow: none;
  }

  .input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(148, 163, 184, 0.9);
    transition: all 0.3s ease;
  }

  .input-wrapper:focus-within .input-icon {
    color: #fed7aa;
    transform: translateY(-50%) scale(1.08);
    text-shadow: 0 0 10px rgba(249, 115, 22, 0.75);
  }

  .password-toggle {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: rgba(148, 163, 184, 0.9);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .password-toggle:hover {
    color: #fed7aa;
    transform: translateY(-50%) scale(1.1);
  }

  /* Botón de submit */
  .login-submit {
    width: 100%;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #f97316, #ea580c);
    border: none;
    border-radius: 12px;
    color: #020617;
    font-weight: 700;
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
    overflow: hidden;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.35);
    border: 1px solid rgba(248, 250, 252, 0.75);
  }

  .login-submit::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.35),
      transparent
    );
    transition: left 0.55s ease;
  }

  .login-submit:hover::before {
    left: 100%;
  }

  .login-submit:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 16px 35px rgba(249, 115, 22, 0.55),
      0 0 40px rgba(249, 115, 22, 0.4);
  }

  .login-submit:active {
    transform: translateY(0);
  }

  /* Errores */
  .form-error {
    color: #fecaca;
    font-size: 0.85rem;
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    animation: shake 0.5s ease-in-out;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
  }

  .alert-error {
    background: rgba(248, 113, 113, 0.15);
    border: 1px solid rgba(248, 113, 113, 0.6);
    color: #fee2e2;
    padding: 0.9rem 1.1rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: slideDown 0.5s ease-out;
    backdrop-filter: blur(15px);
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
  }

  @keyframes slideDown {
    0% { opacity: 0; transform: translateY(-10px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  /* Checkbox Recordar sesión */
  .checkbox-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
  }

  .custom-checkbox {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(148, 163, 184, 0.8);
    border-radius: 6px;
    position: relative;
    transition: all 0.25s ease;
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(10px);
  }

  .checkbox-input:checked + .custom-checkbox {
    background: linear-gradient(135deg, #f97316, #fb923c);
    border-color: transparent;
    box-shadow: 0 0 12px rgba(249, 115, 22, 0.8);
  }

  .checkbox-input:checked + .custom-checkbox::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -55%);
    color: #020617;
    font-weight: 800;
    font-size: 0.8rem;
  }

  /* CTA Crear cuenta (más destacado) */
  .create-account-wrapper {
    text-align: center;
  }

  .create-account-text {
    color: rgba(226, 232, 240, 0.8);
    font-size: 0.9rem;
    margin-bottom: 0.9rem;
  }

  .create-account-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.55rem;
    padding: 0.8rem 1.8rem;
    border-radius: 999px;
    border: 1px solid rgba(251, 191, 36, 0.85);
    background: radial-gradient(circle at top,
              rgba(249, 115, 22, 0.25),
              rgba(15, 23, 42, 0.95));
    color: #fef9c3;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    transition: all 0.25s ease;
    box-shadow: 0 0 20px rgba(251, 191, 36, 0.25);
  }

  .create-account-btn i {
    font-size: 0.9rem;
  }

  .create-account-btn:hover {
    transform: translateY(-2px);
    box-shadow:
      0 14px 30px rgba(251, 191, 36, 0.45),
      0 0 40px rgba(251, 191, 36, 0.5);
    border-color: rgba(253, 224, 71, 0.95);
  }

  .create-account-btn:active {
    transform: translateY(0);
  }

  /* Responsive */
  @media (max-width: 640px) {
    .login-card {
      margin: 1rem;
      padding: 2rem;
      min-height: 450px;
    }
  }

  .fade-in-up {
    animation: fadeInUp 0.8s ease-out;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="login-container">
  <!-- Video de fondo general -->
  <video class="login-video-bg" muted loop playsinline
         preload="none"
         poster="{% static 'img/hero-poster.jpg' %}"
         data-src-mp4="{% static 'videos/login.mp4' %}"
         data-src-webm="{% static 'videos/login.webm' %}"
         aria-label="Video de fondo del Nexo de los Ecos">
    <img src="{% static 'img/hero-poster.jpg' %}" alt="Fondo del Nexo de los Ecos">
  </video>

  <div class="login-overlay"></div>
  <div class="login-particles" id="loginParticles"></div>

  <div class="max-w-md w-full mx-4">
    <div class="login-card">
      <div class="login-content">
        <!-- Header -->
        <div class="login-header fade-in-up" style="animation-delay: 0.1s">
          <div class="login-icon">
            <img src="{% static 'core/icons/NeoForceGames.png' %}" alt="NeoForce Games" class="login-custom-icon">
          </div>
          <h1 class="h1-glow text-3xl font-bold mb-2 text-center">Entrar al Nexo</h1>
          <p class="text-white/80 text-base text-center">
            Accede a tu cuenta para continuar tu viaje
          </p>
        </div>

        <!-- Formulario -->
        <form method="post" class="space-y-6" novalidate>
          {% csrf_token %}
          
          {% if form.non_field_errors %}
          <div class="alert-error" role="alert">
            <i class="fa-solid fa-circle-exclamation"></i>
            {{ form.non_field_errors.0 }}
          </div>
          {% endif %}

          <!-- Usuario / Email -->
          <div class="form-group fade-in-up" style="animation-delay: 0.2s">
            <label for="id_username" class="form-label">
              Usuario o Email
            </label>
            <div class="input-wrapper">
              {{ form.username }}
              <i class="fa-solid fa-user input-icon"></i>
            </div>
            {% if form.username.errors %}
            <div class="form-error">
              <i class="fa-solid fa-circle-exclamation"></i>
              {{ form.username.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Contraseña -->
          <div class="form-group fade-in-up" style="animation-delay: 0.3s">
            <label for="id_password" class="form-label">
              Contraseña
            </label>
            <div class="input-wrapper">
              {{ form.password }}
              <i class="fa-solid fa-lock input-icon"></i>
              <button type="button" class="password-toggle" id="passwordToggle" aria-label="Mostrar contraseña">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
            {% if form.password.errors %}
            <div class="form-error">
              <i class="fa-solid fa-circle-exclamation"></i>
              {{ form.password.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Recordar sesión (sin "olvidaste tu contraseña") -->
          <div class="flex items-center justify-between fade-in-up" style="animation-delay: 0.4s">
            <label class="checkbox-container">
              <input type="checkbox" name="remember" class="checkbox-input sr-only">
              <span class="custom-checkbox"></span>
              <span class="text-white/80 text-sm">Recordar sesión</span>
            </label>
          </div>

          <!-- Submit -->
          <button type="submit" class="login-submit fade-in-up" style="animation-delay: 0.5s">
            <span>Continuar al Nexo</span>
            <i class="fa-solid fa-arrow-right ml-2"></i>
          </button>
        </form>

        <!-- CTA Crear cuenta destacado -->
        <div class="mt-8 pt-6 border-t border-white/15 fade-in-up" style="animation-delay: 0.6s">
          <div class="create-account-wrapper">
            <p class="create-account-text">
              ¿Primera vez en el Nexo?
            </p>
            <a href="/accounts/register/" class="create-account-btn">
              <i class="fa-solid fa-user-plus"></i>
              <span>Crear cuenta nueva</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Cargar video de fondo
  const video = document.querySelector('.login-video-bg');
  if (video) {
    const src = video.dataset.srcMp4;
    if (src && !video.src) {
      video.src = src;
      video.load();
      video.play().catch(e => {
        console.log('Autoplay prevented:', e);
        document.addEventListener('click', function playVideo() {
          video.play();
          document.removeEventListener('click', playVideo);
        });
      });
    }
  }

  // Partículas decorativas
  const particlesContainer = document.getElementById('loginParticles');
  if (particlesContainer) {
    const particleCount = 12;
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'login-particle';
      
      const size = Math.random() * 6 + 2;
      const posX = Math.random() * 100;
      const posY = Math.random() * 100;
      const delay = Math.random() * 5;
      const duration = Math.random() * 4 + 6;
      
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      particle.style.left = `${posX}vw`;
      particle.style.top = `${posY}vh`;
      particle.style.animationDelay = `${delay}s`;
      particle.style.animationDuration = `${duration}s`;
      
      particlesContainer.appendChild(particle);
    }
  }

  // Toggle visibilidad contraseña
  const passwordToggle = document.getElementById('passwordToggle');
  const passwordField = document.getElementById('id_password');
  
  if (passwordToggle && passwordField) {
    passwordToggle.addEventListener('click', function() {
      const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordField.setAttribute('type', type);
      const icon = this.querySelector('i');
      icon.className = type === 'password' ? 'fa-solid fa-eye' : 'fa-solid fa-eye-slash';
    });
  }

  // Efectos de focus
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    if (input.type !== 'checkbox') {
      input.style.paddingLeft = '3rem';
    }

    input.addEventListener('focus', function() {
      const wrapper = this.parentElement;
      if (wrapper && wrapper.classList.contains('input-wrapper')) {
        wrapper.style.transform = 'translateY(-1px)';
      }
    });
    
    input.addEventListener('blur', function() {
      const wrapper = this.parentElement;
      if (wrapper && wrapper.classList.contains('input-wrapper')) {
        wrapper.style.transform = 'translateY(0)';
      }
    });
  });

  // Efecto de carga en submit
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function(e) {
      const submitBtn = this.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> Accediendo...';
        submitBtn.disabled = true;
      }
    });
  }
});
</script>
{% endblock %}
